<!DOCTYPE html>
 
<html>
 <head>
 <title>GAME</title>
 </head>
<body>
 <canvas id="canvas" width="500" height="500" style="border:1px solid #000000"></canvas>
 <script>
 var ctx=document.getElementById("canvas").getContext("2d");
 var height=500;
 var width=500;
 var img_player=new Image();
 img_player.src="Game/ch2.png"
 var obsList1={};
 var obsList2={};
 var trophyList={};
 var enemyList={};
 var map=new Image();
 map.src="Game/background.png";
 var finish=new Image();
 finish.src="Game/girl3.png";
 var wall=new Image();
 wall.src="Game/ev.png";
 var ene=new Image();
 ene.src="Game/ev.png";
 
 
 var level=1;
 
 var player={
 	x:10,
    y:10,
 	width:60,
 	height:60,
 	img:img_player,
 	up:false,
 	down:false,
 	left:false,
 	right:false,
 };
 var trophyCreate=function(id,x,y,width,height){
 	var trophy=
 	{x:x,
 	y:y,
 	width:width,
 	height:height,
 	id:id,
 	img:finish,};
 trophyList[id]=trophy;
 };
var obsCreate1=function(id,x,y,width,height)
{var obs={
x:x,
y:y,
width:width,
height:height,
id:id,
 };
 obsList1[id]=obs;}
 var obsCreate2=function(id,x,y,width,height)
{var obs={
x:x,
y:y,
width:width,
height:height,
id:id,
 };
 obsList2[id]=obs;}
 var enemyCreate=function(id,x,y)
 {
var enemy={
x:x,
y:y,
spdx:3,
spdy:3,
width:60,
height:60,
id:id,

 };
enemyList[id]=enemy; 
 
 };


var checkColew=function(e,o)
{/*return (e.x-player.x+width/2<=o.x-player.x+width/2+o.width//-20
	&&  o.x-player.x+width/2<=e.x-player.x+width/2+e.width//-20
	&&  e.y-player.y+height/2<=o.y-player.y+height/2+o.height//-40
	&&  o.y-player.y+height/2<=e.y-player.y+height/2+e.height)//-10)*/
return (e.x-player.x+width/2<=o.x+o.width-player.x+width/2
    && o.x+o.width-player.x+width/2<=e.x+e.width-player.x+width/2
    &&  e.y-player.y+height/2<=o.y+o.height-player.y+height/2
    &&  o.y+o.height-player.y+height/2<=e.y+e.height-player.y+height/2)

/*if(e.x-player.x+width/2<=o.x+o.width-player.x+width/2||o.x+o.width-player.x+width/2<=e.x+e.width-player.x+width/2)
 		e.spdx=-e.spdx;
if(e.y-player.y+height/2<=o.y+o.height-player.y+height/2||o.y+o.height-player.y+height/2<=e.y+e.height-player.y+height/2 )
 		e.spdy=-e.spdy;
return e;*/
}

var checkCol=function(p,e)
{return (width/2<=e.x-p.x+width/2+e.width-20
	&&  e.x-p.x+width/2<=width/2+p.width-20
	&&  height/2<=e.y-p.y+height/2+e.height-40
	&&  e.y-p.y+height/2<=height/2+p.height-10)
}
var checkFin=function(p,t)
{var dfx=t.x-player.x+width/2;
	var dfy=t.y-player.y+height/2;
	return (width/2<=dfx-5+t.width
	&&  dfx<=width/2+p.width-10.5
	&&  height/2<=dfy-5+t.height
	&&  dfy<=height/2+p.height-10.5)
}

document.onkeydown=function(event){
	if(event.keyCode==87)   //w
		player.up=true;
	if(event.keyCode==65)   //a
		player.left=true;
	if(event.keyCode==83)  //s
		player.down=true;
	if(event.keyCode==68)  //d
		player.right=true;

}
document.onkeyup=function(event){
	if(event.keyCode==87)   //w
		player.up=false;
	if(event.keyCode==65)   //a
		player.left=false;
	if(event.keyCode==83)  //s
		player.down=false;
	if(event.keyCode==68)  //d
		player.right=false;

}

var updatePlayerPos=function()
{
	if(player.up==true)
		player.y-=5;
	if(player.down==true)
		player.y+=5;
    if(player.right==true)
		player.x+=5;
	if(player.left==true)
		player.x-=5;
	
if(checkFin(player,trophyList[1]))
	{level++;
		//clearRect(0,0,width,height);
		player.x=50;
		player.y=40;
		//createLvl(level);
	}
     
    if(level==1)
    {for(var i in obsList1)
 	if(checkCol(player,obsList1[i]))
 		  {if(player.up==true)
		      player.y+=5;
	      if(player.down==true)
		      player.y-=5;
          if(player.right==true)
		      player.x-=5;
	      if(player.left==true)
		      player.x+=5;}}
    if(level==2)
    	{for(var j in obsList2)
 	if(checkCol(player,obsList2[j]))
 		  {if(player.up==true)
		      player.y+=5;
	      if(player.down==true)
		      player.y-=5;
          if(player.right==true)
		      player.x-=5;
	      if(player.left==true)
		      player.x+=5;}}

          
	if(player.x<-width/2) 
		player.x=-width/2; 
	if(player.x>3*map.width-player.width-width/2) 
		player.x=3*map.width-player.width-width/2; 
	if(player.y<-height/2) 
		player.y=-height/2; 
	if(player.y>3*map.height-player.height-height/2) 
		player.y=3*map.height-player.height-height/2;  


   
}
var drawMap=function()
{var x=-player.x;
	var y=-player.y;
	
ctx.drawImage(map,0,0,map.width,map.height,x,y,map.width*3,map.height*3);
}
var dir=0;

var drawPlayer=function(char)
{ 
    var x=width/2;
    var y=height/2;
	
	if(player.down==true)
		dir=0;
	if(player.up==true)
		dir=3;
	if(player.left==true)
		dir=1;
	if(player.right==true)
		dir=2;
	var framew=char.img.width/12;
	var frameh=char.img.height/8;
	ctx.drawImage(char.img,0,dir*frameh,framew,frameh,x,y,char.width,char.height);
	
}
var drawEnemy=function(char)
{
	var dex=char.x-player.x+width/2;
 var dey=char.y-player.y+height/2;
 ctx.drawImage(ene,0,3*(ene.height/47),ene.width/64,ene.height/47,dex,dey,60,60);

}
var drawObs=function(char)
{   ctx.save();

	var dx=char.x-player.x;
	var dy=char.y-player.y;
	dx+=width/2;
	dy+=height/2;
	
	ctx.drawImage(wall,0,18*(wall.height/47),wall.width/64,wall.height/47,dx,dy,60,60);
	ctx.restore();
}
var updateEnemyPos=function(char)
{ 

 	char.x+=char.spdx;
 	char.y+=char.spdy;
 	for(var i in obsList1)
	if(checkColew(char,obsList1[i]))
    {char.spdx=-char.spdx;
 	char.spdy=-char.spdy;}

 	
 	if(char.x<-width/2||char.x>3*map.width-width/2-60)
 		char.spdx=-char.spdx;
 	if(char.y<-height/2||char.y>3*map.height-height/2-60)
 		char.spdy=-char.spdy;

}

 
 var drawTrophy=function(char)
 {
 	var dtx=char.x-player.x;
	var dty=char.y-player.y;
	dtx+=width/2;
	dty+=height/2;
 	ctx.drawImage(finish,0,0,finish.width/10,finish.height/5,dtx,dty,char.width,char.height);
 }
 var update=function()
 {  ctx.clearRect(0,0,width,height);
 	drawMap();
 	
 	
 	
 	drawPlayer(player);
    
    
 	
 	createLvl(level);
 	

 	updatePlayerPos(player);
 	


 }
 enemyCreate(1,200,200);
  var createLvl=function(l)
  {if(l==1)
  {for(var j=-60,k=0;j<5*60;j=j+60,k++)
  	obsCreate1(k,j,70,60,60);

  for(var j=j,k=k+1;j<8*60;j=j+60,k++)
    obsCreate1(k,j+60,70,60,60);
    	

  for(j=105,k=k+1;j<17*35;j=j+35,k++)
    obsCreate1(k,-60,j,60,60);	

for(j=105,k=k+1;j<10*35;j=j+35,k++)
	obsCreate1(k,480,j,60,60);
for(j=-60,k=k+1;j<9*60;j=j+60,k++)
	obsCreate1(k,j,595,60,60);
for(j=17*35,k=k+1;j>11*35;j=j-35,k++)
	obsCreate1(k,480,j,60,60);
for(j=540,k=k+1;j<540+3*60;j=j+60,k++)
	obsCreate1(k,j,(70+350),60,60);
for(j=540,k=k+1;j<540+3*60;j=j+60,k++)
	obsCreate1(k,j,(70+35*7),60,60);
for(j=70+11*35,k=k+1;j<(70+11*35)+9*35;j=j+35,k++)
	obsCreate1(k,11*60,j,60,60);
for(j=8*35,k=k+1;j>5*35;j=j-35,k++)
	obsCreate1(k,11*60,j,60,60);
for(j=12*60,k=k+1;j<(13*60)+(5*60);j=j+60,k++)
	obsCreate1(k,j,70+4*35,60,60);
for(j=70+4*35,k=k+1;j<(70+4*35)+22*35;j=j+35,k++)
	obsCreate1(k,13*60+300,j,60,60);
for(j=11*60,k=k+1;j<(13*60)+(3*60);j=j+60,k++)
	obsCreate1(k,j,70+20*35,60,60);
for(j=70+21*35,k=k+1;j<(70+21*35)+11*35;j=j+35,k++)
	obsCreate1(k,15*60,j,60,60);
for(j=13*60+5*60,k=k+1;j<((13*60)+(5*60))+4*60;j=j+60,k++)
	obsCreate1(k,j,70+4*35+22*35,60,60);


 //enemyCreate(1,200,300);

 for(var f in enemyList)
  {drawEnemy(enemyList[f]);

updateEnemyPos(enemyList[f]);}
  
  
for(var i in obsList1)
 	{drawObs(obsList1[i]);
     }
 trophyCreate(1,1200,1000,70,70);
 drawTrophy(trophyList[1]);
}
/*if(l==2)
{
	for(var t=0;)
}*/
  
}
  

  //enemyCreate(3,100,100,15,15);
 setInterval(update,40);
 </script>
 </body>
 </html> 	
