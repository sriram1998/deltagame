<!DOCTYPE html>
 
<html>
 <head>
 <title>GAME</title>
 </head>
<body>
 <canvas id="canvas" width="500" height="500" style="border:1px solid #000000"></canvas>
 <script>
 var ctx=document.getElementById("canvas").getContext("2d");
 var height=500;
 var width=500;
 var img_player=new Image();
 img_player.src="Game/hero.png"
 var obsList1={};
 var obsList2={};
 var trophyList={};
 var map=new Image();
 map.src="Game/background.png";
 var finish=new Image();
 finish.src="Game/girl3.png";
 var wall=new Image();
 wall.src="Game/ev.png";
 
 var level=1;
 var player={
 	x:50,
    y:40,
 	width:40,
 	height:40,
 	img:img_player,
 	up:false,
 	down:false,
 	left:false,
 	right:false,
 };
 var trophyCreate=function(id,x,y,width,height){
 	var trophy=
 	{x:x,
 	y:y,
 	width:width,
 	height:height,
 	id:id,
 	img:finish,};
 trophyList[id]=trophy;
 };
var obsCreate1=function(id,x,y,width,height)
{var obs={
x:x,
y:y,
width:width,
height:height,
id:id,
 };
 obsList1[id]=obs;}
 var obsCreate2=function(id,x,y,width,height)
{var obs={
x:x,
y:y,
width:width,
height:height,
id:id,
 };
 obsList2[id]=obs;}


var checkCol=function(p,e)
{return (width/2<=e.x-p.x+width/2+e.width-5
	&&  e.x-p.x+width/2<=width/2+p.width-10.5
	&&  height/2<=e.y-p.y+height/2+e.height-27
	&&  e.y-p.y+height/2<=height/2+p.height-10.5)
}
var checkFin=function(p,t)
{var dfx=t.x-player.x+width/2;
	var dfy=t.y-player.y+height/2;
	return (width/2<=dfx-5+t.width
	&&  dfx<=width/2+p.width-10.5
	&&  height/2<=dfy-5+t.height
	&&  dfy<=height/2+p.height-10.5)
}

document.onkeydown=function(event){
	if(event.keyCode==87)   //w
		player.up=true;
	if(event.keyCode==65)   //a
		player.left=true;
	if(event.keyCode==83)  //s
		player.down=true;
	if(event.keyCode==68)  //d
		player.right=true;

}
document.onkeyup=function(event){
	if(event.keyCode==87)   //w
		player.up=false;
	if(event.keyCode==65)   //a
		player.left=false;
	if(event.keyCode==83)  //s
		player.down=false;
	if(event.keyCode==68)  //d
		player.right=false;

}
var updatePlayerPos=function()
{
	if(player.up==true)
		player.y-=5;
	if(player.down==true)
		player.y+=5;
    if(player.right==true)
		player.x+=5;
	if(player.left==true)
		player.x-=5;
	
if(checkFin(player,trophyList[level]))
	{level++;
		//clearRect(0,0,width,height);
		player.x=50;
		player.y=40;
		//createLvl(level);
	}
     
    if(level==1)
    {for(var i in obsList1)
 	if(checkCol(player,obsList1[i]))
 		  {if(player.up==true)
		      player.y+=5;
	      if(player.down==true)
		      player.y-=5;
          if(player.right==true)
		      player.x-=5;
	      if(player.left==true)
		      player.x+=5;}}
    if(level==2)
    	{for(var j in obsList2)
 	if(checkCol(player,obsList2[j]))
 		  {if(player.up==true)
		      player.y+=5;
	      if(player.down==true)
		      player.y-=5;
          if(player.right==true)
		      player.x-=5;
	      if(player.left==true)
		      player.x+=5;}}

          
	if(player.x<-width/2) //player.width/2-20)
		player.x=-width/2; //player.width/2-20;
	if(player.x>2*map.width-player.width-width/2) //map.width-player.width/2)
		player.x=2*map.width-player.width-width/2; //-player.width/2;
	if(player.y<-height/2) //player.height/2-20)
		player.y=-height/2; //player.height/2-20;
	if(player.y>2*map.height-player.height-height/2) //-player.height/2)
		player.y=2*map.height-player.height-height/2;  //-player.height/2;


   
}
var drawMap=function()
{var x=-player.x;
	var y=-player.y;
	//ctx.drawImage(map,0,0,map.width,map.height,x,y,map.width*2,map.height*2);
ctx.drawImage(map,0,0,map.width,map.height,x,y,map.width*2,map.height*2);
}
//var dir=0;
var drawPlayer=function(char)
{ 
    var x=width/2;//-char.img.width/2;
    var y=height/2;
	
	/*if(player.down==true)
		dir=0;
	if(player.up==true)
		dir=1;
	if(player.left==true)
		dir=2;
	if(player.right==true)
		dir=3;*/
	//var framew=char.img.width/10;
	//var frameh=char.img.height/4;
	ctx.drawImage(char.img,x,y);
	
}
var drawEnemy=function(char)
{   ctx.save();
	ctx.fillStyle="red";
	var dx=char.x-player.x;
	var dy=char.y-player.y;
	dx+=width/2;
	dy+=height/2;
	//ctx.fillRect(dx,dy,char.width,char.height);
	ctx.drawImage(wall,0,18*(wall.height/47),wall.width/64,wall.height/47,dx,dy,60,60);
	ctx.restore();
}
/*var updateEnemyPos=function(char)
{char.x+=char.spdx;
 	char.y+=char.spdy;
 	
 	if(char.x<0||char.x>width)
 		char.spdx=-char.spdx;
 	if(char.y<0||char.y>height)
 		char.spdy=-char.spdy;

}*/

 
 var drawTrophy=function(char)
 {
 	var dtx=char.x-player.x;
	var dty=char.y-player.y;
	dtx+=width/2;
	dty+=height/2;
 	ctx.drawImage(finish,0,0,finish.width/10,finish.height/5,dtx,dty,char.width,char.height);
 }
 var update=function()
 {  ctx.clearRect(0,0,width,height);
 	drawMap();
 	
 	
 	//drawTrophy();
 	drawPlayer(player);
 	
 	createLvl(level);
 	

 	updatePlayerPos(player);


 }
  
  var createLvl=function(l)
  {if(l==1)
  {for(var j=0,k=0;j<10*60;j=j+60,k++)
  	obsCreate1(k,j,70,60,60);

  
  
for(var i in obsList1)
 	{drawEnemy(obsList1[i]);
     }
 trophyCreate(1,400,400,70,70);
 drawTrophy(trophyList[1]);
}
/*if(l==2)
{
	for(var t=0;)
}*/
  
}
  

  //enemyCreate(3,100,100,15,15);
 setInterval(update,40);
 </script>
 </body>
 </html> 	
